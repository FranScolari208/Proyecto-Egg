<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta content="ie=edge" http-equiv="X-UA-Compatible" />
  <meta content="Nutrividas" name="Grupo7" />
  <title>Nutrividas - Crear Canasta</title>

  <!-- Favicons -->
  <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}" />
  <link th:href="@{/img/favicon.ico}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Newsreader&family=Pacifico&family=Style+Script&display=swap"
        rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link th:href="@{/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
  <link th:href="@{/icofont/icofont.min.css}" rel="stylesheet">
  <link th:href="@{/boxicons/css/boxicons.min.css}" rel="stylesheet">
  <link th:href="@{/owl.carousel/assets/owl.carousel.min.css}" rel="stylesheet">
  <link th:href="@{/venobox/venobox.css}" rel="stylesheet">
  <link th:href="@{/aos/aos.css}" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link th:href="@{/css/style.css}" rel="stylesheet">

  <link rel="stylesheet" th:href="@{/css/canasta.css}">

</head>

<body>

<!-- ======= Header ======= -->
<header id="header" class="fixed-top">
  <div class="container d-flex">

    <div class="logo">
      <a th:href="@{/}"><img th:src="@{/img/logo.png}" alt="" class="img-fluid"></a>
    </div>

    <div class="logo mr-auto">
      <h2 class="text-light mt-0" style="color: #1bac91 !important;">&nbsp;Nutrividas</h2>
    </div>

    <nav class="nav-menu d-none d-lg-block">
      <ul>
        <li><a th:href="@{/}">Inicio</a></li>
        <li><a th:href="@{/#contact}">Contáctanos</a></li>&nbsp;&nbsp;&nbsp;
        <!-- Botón Usuario si está loggeado -->
        <li class="drop-down" sec:authorize="isAuthenticated()">
          <a aria-expanded="false" class="dropdown-click" data-bs-toggle="dropdown" href="#" id="dropdown-avatar"
            style="margin-top: -13px;" role="button float-right">
            <img class="rounded-circle" th:src="@{/img/user-nopic.png}" width="50">
          </a>
          <ul>
            <a href="#"><b>¡Hola [[${session.usernameSession}]]!</b></a>
            <li class="dropdown-divider"></li>

            <li><a class="dropdown-item" th:href="@{/modificar/__${session.id}__}">Editar perfil</a></li>
            <li><a class="dropdown-item" th:href="@{/logout}">Cerrar sesión</a></li>
          </ul>
        </li>
        <!-- Fin Botón Usuario si está loggeado -->

      </ul>
    </nav><!-- .nav-menu -->

  </div>
</header><!-- End Header -->

<!-- ======= TÍTULO ======= -->

<section class="titulo" id="titulo">

  <div class="texto-comedores">
    <p> Productos que alimentan</p>
    <p>
      <span class="word color">sonrisas</span>
    </p>
  </div>
</section><!-- End TÍTULO -->

<!-- ======= TABLA PRODUCTOS ======= -->
<section>
  <div class="container" id="tabla-productos">

    <!-- Mensaje éxito y error -->
    <div th:if="${error != null} OR ${success != null}" th:classappend="${error != null} ? 'alert-danger' : 'alert-success'" class="alert alert-warning alert-dismissible fade show" role="alert">
      <i th:classappend="${error != null} ? 'fa-times-circle' : 'fa-check-circle'" class="fas "></i>
      [[${error != null} ? ${error} : ${success}]]
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <!-- *************** -->
    <div class="row">
      <div class="col col-md-6 mb-5" style="background-color: #F8F9FA;">
        <h4 th:text="${titulo}" class="mt-5 text-center" ></h4>
        <form class="m-5" th:action="@{/canasta/__${accion}__}" th:object="${canasta}" method="POST">

          <input th:if="${canasta.id} != null" th:field="*{id}" type="hidden"
                 class="form-control rounded-pill border-0 shadow-sm px-4">

          <div class="form-group mt-5 mb-3">
            <input th:field="*{descripcion}" type="text" placeholder="Descripcion" required="" autofocus=""
                   class="form-control rounded-pill border-0 shadow-sm px-4">
          </div>
          <div class="error text-start" th:if="${#fields.hasErrors('descripcion')}"
               th:errors="*{descripcion}"></div>

          <div class="row">
            <div class="col-md-5 mr-3">
              <select th:with="comedor=*{comedor}" name="comedor" id="comedor" class="form-control rounded-pill border-0 shadow-sm px-4 mb-3" style="width: auto;" >
                <option th:each="comedor : ${comedores}"
                        th:value="${comedor.id}"
                        th:text="${comedor.nombre}"
                        th:selected="${canasta.comedor != null} ? ${comedor.nombre} == *{comedor.nombre} : false">
                </option>
              </select>
            </div>
            <div class="col-md-6">
              <div class="form-group mb-4">
                <input th:field="*{cantidadDePersonas}" type="number" placeholder="Cantidad de personas" required="" autofocus=""
                       class="form-control rounded-pill border-0 shadow-sm px-4">
              </div>
              <div class="error text-start" th:if="${#fields.hasErrors('cantidadDePersonas')}"
                   th:errors="*{cantidadDePersonas}"></div>
            </div>
          </div>

          <!--<div th:each="elemento : ${canasta.elementos}" class="form-check">
            <input th:id="${elemento.id}" th:name="${elemento.id}" th:field="${elementos}" th:field="*{elementos}"
                   class="form-check-input" type="checkbox"  id="flexCheckDefault">
            <label th:for="${elemento}"  th:text="${elemento}" class="form-check-label" for="flexCheckDefault">
            </label>
          </div>

          <tr th:each="elemento,status : ${canasta.elementos}">
            <td><input type="checkbox" th:checked="${elemento}" th:value="*{elementos[__${status.index}__]}" th:field="*{elementos[__${status.index}__]}"/></td>
          </tr>-->

          <button type="submit"
                  class="btn btn-primary btn-block text-uppercase  rounded-pill shadow-sm mb-2 mt-4"
                  id="boton-SignIn" th:text="${action == 'guardar'} ? 'Crear canasta' : 'Guardar cambios'"></button>
        </form>

        <!-- TARJETA -->
          <div class="card mb-3 ml-3" style="max-width: 540px;" th:unless="${canasta.elementos == null}"  th:each="elemento : ${canasta.elementos}">
            <div class="row g-0">
              <div class="col-md-4" th:if="${elemento.producto.foto == null}"
                   th:style="'width:80px !important; heigth: 40px !important; z-index: 100; background-image:url( '+@{/img/productos/productosDefault.jpg}+' ) !important;background-repeat: no-repeat;
              background-position: center;background-size: cover;'"></div>
              <div class="col-md-4" th:unless="${elemento.producto.foto == null}" th:style="'background-image:url(http://localhost:8080/fotos/'+${elemento.producto.foto.id}+') !important;background-repeat: no-repeat;
                background-position: center; background-size: cover;'"></div>
              <div class="col-md-6">
                <div class="card-body">
                  <h5 th:text="${elemento.producto.nombre}" class="card-title"></h5>
                  <p th:text="| $ ${elemento.producto.precio}|" class="card-text"></p></br>
                  <p class="card-text">Cantidad:</p>
                  <input type="number" th:id="cantidad+${elemento.producto.id}" th:name="cantidad+${elemento.producto.id}" th:value="${elemento.cantidadNecesaria}" disabled>
                  <button th:id="editarCantidad+${elemento.producto.id}"  th:onclick="'javascript:editarCantidad(' + ${elemento.producto.id} + ')'" class=" habilitado p-0"><box-icon name='pencil'   th:id="editarIcono+${elemento.producto.id}"></box-icon></button>
                  <button th:id="confirmarCantidad+${elemento.producto.id}"  disabled th:onclick="'javascript:confirmarCantidad(' + ${elemento.producto.id} + ')'" class=" deshabilitado p-0"><box-icon  name='check-circle' th:id="confirmarIcono+${elemento.producto.id}"></box-icon></button>
                </div>
              </div>
              <div class="col-md-2 align-self-center">
                  <form method="POST" th:action="@{/elemento/eliminar/__${elemento.id}__}">
                      <button type="submit"> <box-icon name='trash-alt' type='solid' animation='tada-hover'></box-icon></button>
                  </form>
              </div>
            </div>
          </div>
      </div>
      <div class="col col-md-5 mb-5 ml-5" style="background-color: #F8F9FA;">
        <aside>
          <div class="summary mt-4 text-center">

            <div class="summary-subtotal">
              <div class="subtotal-title">Subtotal</div>
              <div class="subtotal-value final-value" id="basket-subtotal">0</div>
            </div>
            <div class="summary-delivery">
              <div class="summary-total-items"> Productos Seleccionados: <span class="total-items"></span></div>
            </div>
            <div class="summary-total">
              <div class="total-title">Total</div>
              <div class="total-value final-value" id="basket-total">0</div>
            </div>
            <div class="summary-checkout">
              <button class="checkout-cta">Finalizar Compra</button>
            </div>
          </div>
        </aside>

      </div>
  </div>

</section>

<!-- ======= Footer ======= -->
<footer id="footer2">
  <div class="copyright2">
    Copyright&copy; 2010-2021 | <strong><span>&nbsp;Nutrividas&nbsp;</span></strong> | Todos los derechos
    reservados
  </div>
</footer><!-- End Footer -->


<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Vendor JS Files -->
<script th:href="@{/jquery/jquery.min.js}"></script>
<script th:href="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:href="@{/jquery.easing/jquery.easing.min.js}"></script>
<script th:href="@{/php-email-form/validate.js}"></script>
<script th:href="@{/owl.carousel/owl.carousel.min.js}"></script>
<script th:href="@{/isotope-layout/isotope.pkgd.min.js}"></script>
<script th:href="@{/venobox/venobox.min.js}"></script>
<script th:href="@{/aos/aos.js}"></script>
<script th:href="@{/js/loader.js}"> </script>
<script src="https://unpkg.com/boxicons@2.1.1/dist/boxicons.js"></script>

<!-- Template Main JS File -->
<script th:href="@{/js/main.js}"></script>

<!--  JQUERY -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- JS PARA TITULO -->
<script th:href="@{/js/titulo.js}"></script>

<!-- BUSCADOR DE PRODUCTOS -->
<script>

         function editarCantidad(id){
            var inputCantidad = document.getElementById('cantidad'+id);
             var botonEditar = document.getElementById('editarCantidad'+id);
             var botonConfirmar = document.getElementById('confirmarCantidad'+id);

            console.log(id);
            inputCantidad.disabled = false;
            botonConfirmar.disabled = false;
            botonEditar.disabled = true;
        }

        function confirmarCantidad(id){

            var inputCantidad = document.getElementById('cantidad'+id);
            var botonEditar = document.getElementById('editarCantidad'+id);
            var botonConfirmar = document.getElementById('confirmarCantidad'+id);

            inputCantidad.disabled = true;
            botonConfirmar.disabled = true;
            botonEditar.disabled = false;


            var cantidad = inputCantidad.value
            $.ajax({
                type: 'GET',
                url:'/elemento/editar_cantidad/'+id+'/'+cantidad
            });
        }

 </script>
</body>

</html>